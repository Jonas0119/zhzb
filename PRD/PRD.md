# 智慧账簿移动端产品需求文档 (PRD)

## 1. 项目概述

### 1.1 产品定位
智慧账簿是一款基于积分钱包的移动端H5应用，为用户提供积分管理、交易、消费等一站式服务。

### 1.2 技术选型
- **前端框架**: Vue 3 + Composition API
- **UI组件库**: Vant UI（移动端优化）
- **开发类型**: H5移动端应用（响应式设计）
- **目标平台**: H5浏览器（主要）、微信小程序、支付宝小程序
- **主题色彩**: 橙色系主题（#FF7F50）

### 1.3 核心功能模块
- 首页：积分展示、积分规则说明、邀请卖家
- 积分市场：积分买卖交易
- 公告：平台公告和资讯
- 个人中心：用户信息、钱包管理

### 1.4 积分体系
- **AIC积分**：平台积分类型之一，用户可持有和交易
- **HH积分**：平台积分类型之一，用户可持有和交易
- **积分获取**：仅通过管理员后台给特定用户增加
- **积分交易**：用户可自由定价（人民币元为单位）进行买卖
- **积分有效期**：无限制
- **积分转换**：暂不支持不同积分类型间转换

### 1.5 用户认证
- **注册方式**：用户名 + 密码
- **登录方式**：用户名 + 密码
- **用户信息**：仅需手机号（需验证格式合法性）
- **实名认证**：暂不需要

### 1.6 钱包体系
- **余额充值**：模拟充值，用户填写金额即可成功
- **余额来源**：充值 + 卖积分获得
- **银行卡绑定**：Demo功能，填写信息即可绑定
- **提现功能**：暂不实现
- **冻结机制**：买卖过程中的临时冻结状态

## 2. 用户角色定义

### 2.1 普通用户
- 积分持有者
- 可进行积分买卖交易
- 可查看公告信息
- 既是买家也是卖家
- 无需审核即可成为卖家

### 2.2 管理员
- 可给特定用户增加积分
- 可查看平台交易手续费收入
- 可管理平台公告
- 可设定交易费率

## 3. 功能需求详述

### 3.1 首页模块

#### 3.1.1 页面布局
- **顶部区域**：
  - 应用标题"智慧账簿(积分钱包)"
  - 橙色渐变背景
  - 状态栏信息显示（时间、网络、电量）
- **主要功能区**：
  - "邀请商家入驻"按钮（大按钮，突出显示）
  - "积分玩法规则"按钮
- **积分展示区**：
  - AIC积分：圆形图标 + 数值显示
  - HH积分：圆形图标 + 数值显示
  - 实时余额更新
- **底部导航**：首页、积分市场、公告、我的（橙色激活状态）

#### 3.1.3 参考UI设计说明
- 左侧为简洁线框图设计，右侧为丰富的参考实例
- 主色调为橙色系渐变背景 (#FF7F50)
- 采用卡片式布局，圆角设计
- 图标采用圆形设计，简洁明了
- 底部导航栏固定，激活状态用橙色标识

#### 3.1.2 功能特性
- 积分余额实时显示
- 邀请卖家入驻（任何人都可以是卖家，无需审核）
- 积分规则说明入口

### 3.2 积分市场模块

#### 3.2.1 页面布局
- **顶部区域**：
  - 页面标题"积分市场"
  - 搜索功能（可选）
  - 筛选按钮（价格、数量排序）
- **交易类型切换**：
  - 卖单/买单 Tab切换
  - 橙色激活状态指示
- **筛选排序功能**：
  - 按价格排序（升序/降序）
  - 按数量排序
  - 筛选条件展示
- **交易列表**：
  - 卡片式布局
  - 显示：积分类型、数量、单价、总价
  - 右侧操作按钮：卖出/买入（橙色按钮）
- **底部导航**：与首页保持一致

#### 3.2.1.1 参考UI设计说明
- 左侧为简洁交易卡片设计，显示核心信息
- 右侧参考实例展示了丰富的交易列表界面
- 卖单信息包含：积分类型、数量、单价、总价
- 橙色"卖出"按钮突出显示，便于用户操作
- Tab切换采用橙色高亮当前选中状态

#### 3.2.2 功能特性
- 积分交易发布
- 交易订单管理
- 价格排序筛选
- 个人发布管理

#### 3.2.3 交互流程
- 发布卖单
  1) 进入“发布卖单”页 → 选择积分类型（AIC/HH）
  2) 输入数量、单价 → 提交
  3) 成功后生成卖单，状态为“待成交”，对应积分数量进入“冻结积分”
  4) 卖单展示在市场列表与“我的订单”中
- 购买积分
  1) 在市场列表选择一条卖单 → 点击“买入”
  2) 输入购买数量（默认最大为卖单剩余数量）
  3) 校验余额充足 → 点击“支付”（模拟支付，直接成功）
  4) 成交成功：买方获得积分、卖方余额增加（扣手续费），卖单数量减少或标记完成
- 取消卖单
  - 条件：仅卖家本人、订单未成交部分可取消
  - 结果：未成交部分的冻结积分解冻回可用积分

#### 3.2.4 表单与校验
- 通用规则
  - 所有数字字段仅支持正数，最多两位小数（单价）、最多四位小数（数量，若需整数则取整开关）
  - 超出范围、非法字符即时提示；禁用提交按钮
- 发布卖单字段
  - 积分类型：必填，只能为 AIC 或 HH
  - 数量：必填，> 0，且不超过用户可用积分；提交后同等数量进入冻结
  - 单价（元）：必填，> 0，最多两位小数
  - 预计总价：只读=数量×单价（实时计算）
- 买入字段
  - 购买数量：必填，> 0，且 ≤ 卖单剩余数量
  - 需要金额：只读=购买数量×单价
  - 余额校验：余额 ≥ 需要金额；不足时给出“去充值”入口

#### 3.2.5 状态与异常处理
- 空状态
  - 市场无卖单时展示空态插画+“去发布卖单”按钮
  - “我的订单”无记录时展示空态+返回市场按钮
- 加载与骨架屏
  - 列表使用骨架屏；下拉刷新、上拉分页加载
- 并发与乐观更新
  - 买入/取消操作提交后按钮进入 loading 与防抖 1 秒
  - 接口成功即更新本地数量与状态；失败回滚并提示
- 常见失败提示
  - 余额不足/积分不足/卖单已变更或售罄/网络异常

#### 3.2.6 手续费与结算展示
- 费率：千分之三（可后台配置）。
- 购买侧：确认弹窗显示“应付金额、手续费（买方不承担时为 0）、实付金额”。
- 卖出侧：卖单详情显示“成交总额、手续费、卖家实得”。

#### 3.2.7 排序与筛选细则
- 排序：价格升/降序、数量升/降序（二选一生效），记住用户选择
- 筛选：按积分类型（AIC/HH）、按单价区间、按数量区间
- 条件展示：当前生效的排序与筛选以标签形式展示，支持一键清除

#### 3.2.8 安全与风控（基础）
- 限流与防刷：同一账号单位时间内发布/购买次数限额（默认每分钟 10 次）
- 金额与数量上限：可在后台配置阈值；前端在提交前校验
- 操作日志：发布、买入、取消均记录时间与 IP（后端实现）

### 3.3 公告模块

#### 3.3.1 页面布局
- **顶部区域**：
  - 页面标题"平台公告"
  - 官方公告/前沿资讯 Tab切换
- **公告列表**：
  - 卡片式布局，带有官方标识
  - 显示：标题、发布时间、阅读量
  - 公告类型图标（蓝色/橙色标识）
  - 列表项点击进入详情
- **公告详情页**：
  - 支持富文本内容展示
  - 阅读量自动增加统计
- **底部导航**：与首页保持一致

#### 3.3.1.1 参考UI设计说明
- 左侧为简洁公告卡片设计，显示基本信息
- 右侧参考实例展示了分类公告界面
- 官方公告使用紫色/蓝色卡片突出显示官方身份
- 前沿资讯使用不同颜色区分公告类型
- 每个公告显示发布时间和阅读量统计

#### 3.3.2 功能特性
- 公告列表展示
- 阅读量实时统计
- 公告详情查看（支持富文本格式）
- 公告发布：仅管理员可发布

### 3.4 管理员功能模块

#### 3.4.1 用户积分管理
- 选择已注册用户
- 选择积分类型（AIC积分/HH积分）
- 输入积分数量
- 提交增加积分

#### 3.4.2 公告管理
- 发布公告（支持富文本）
- 编辑公告
- 删除公告

#### 3.4.3 数据统计
- 交易手续费收入统计
- 用户注册统计
- 积分交易统计
- 公告阅读统计

### 3.5 个人中心模块

#### 3.5.1 页面布局
- **用户信息区**：
  - 橙色渐变背景
  - 用户头像（圆形）
  - 用户ID显示（如：用户e463147c）
  - 设置按钮
- **快捷余额展示**：
  - 中收积分、余额、银行卡数量快捷查看
  - 数字化展示当前状态
- **功能菜单分类**：
  - **订单中心**：包含待付款、待发货、待收货、待评价、售后等
  - **积分中心**：发布积分、积分市场订单、委员认证、收款方式等
  - **我的服务**：邀请好友、商家入驻等
- **钱包入口**：我的钱包（独立按钮突出显示）

#### 3.5.1.1 参考UI设计说明
- 左侧为简洁个人信息和功能入口设计
- 右侧参考实例展示了完整的个人中心界面
- 橙色渐变头部区域与品牌色调保持一致
- 功能图标采用橙色系，保持视觉统一性
- 分类清晰的功能模块，便于用户快速找到需要的功能

#### 3.5.2 钱包功能详细页面
- **钱包余额卡片**：
  - 橙色渐变背景卡片设计
  - 显示可提现额和冻结余额
  - 中收钱包按钮入口
- **积分余额卡片**：
  - 显示可用积分和冻结积分
  - 快速发货和积分转换按钮
- **Tab功能区**：
  - 资金明细、提现、结算记录三个Tab
  - 支持历史交易记录查询

#### 3.5.2.1 参考钱包UI设计说明
- 左侧为基础钱包余额展示
- 右侧参考实例展示了详细的钱包管理界面
- 采用橙色渐变卡片突出余额信息
- 清晰的Tab导航支持不同类型的交易记录查看

#### 3.5.3 钱包功能
- 钱包余额管理（充值、消费记录）
- 积分余额管理（AIC积分、HH积分）
- 银行卡绑定（Demo功能）
- 冻结余额/积分管理
- 交易记录查询

#### 3.5.4 订单管理
- **订单状态**：
  - 待付款：订单形成但未付款
  - 待评价：付款后但未评价
  - 已完成：评价完成
- **订单详情**：支持查看订单详情页面
- **订单历史**：不限时保存

## 4. UI设计规范与品牌标识

### 4.1 设计语言
- **主色调**：橙色系渐变 (#FF7F50 到 #FF6B35)
- **辅助色**：白色、灰色系 (#F5F5F5, #666666)
- **强调色**：蓝色 (#1890FF)、紫色 (#722ED1)
- **成功色**：绿色 (#52C41A)
- **警告色**：红色 (#FF4D4F)

### 4.2 组件设计规范
- **卡片设计**：圆角 8px，阴影效果，内边距 16px
- **按钮设计**：橙色主按钮，圆角 6px，最小高度 44px
- **输入框**：圆角 6px，边框色 #D9D9D9，聚焦时橙色边框
- **Tab切换**：橙色高亮，下划线指示当前选中

### 4.3 图标规范
- 统一使用圆形图标设计
- 主要功能图标采用橙色填充
- 辅助功能图标采用线性设计
- 图标尺寸：24px（小图标）、32px（中图标）、48px（大图标）

### 4.4 字体规范
- **标题字体**：18px-22px，粗体
- **正文字体**：14px-16px，常规
- **辅助文字**：12px，浅色
- **数字金额**：16px-20px，粗体，橙色突出显示

## 5. 交易规则

### 5.1 积分交易规则
- **交易手续费**：千分之三（可管理员设定）
- **交易限制**：无最小/最大金额限制
- **交易审核**：无需审核，点击支付直接成交
- **资金结算**：
  - 买方：获得对应积分
  - 卖方：钱包余额增加（扣除手续费后）
  - 平台：获得交易手续费收入

### 5.2 支付机制
- **支付方式**：模拟支付，点击支付按钮直接成交
- **无需对接**：不接入真实支付系统
- **交易流程**：用户定价 → 发布卖单 → 买方购买 → 即时成交

### 5.3 卖家入驻机制
- **入驻条件**：无需任何条件和资质
- **入驻流程**：无需审核，任何人都可以是卖家
- **商品类型**：仅限积分交易
- **平台分成**：通过交易手续费（千分之三）获得收益

## 6. 数据安全与性能

### 6.1 数据安全
- 积分和资金数据加密存储
- 交易记录定期备份
- 用户隐私数据保护
- API接口安全认证

### 6.2 性能优化
- 前端代码分割和懒加载
- 图片资源压缩优化
- API接口缓存策略
- 数据库查询优化

## 7. 技术架构

### 7.1 技术栈选择方案

- **前端框架**: Vue 3 + Composition API
- **构建工具**: Vite
- **路由管理**: Vue Router 4
- **状态管理**: Pinia
- **UI组件库**: Vant UI（移动端）
- **HTTP请求**: Axios
- **后端框架**: NestJS
- **数据库**: SQLite（开发）/ MySQL 5.7（生产）
- **ORM**: TypeORM

### 7.2 项目结构
```
frontend/          # 前端项目
├── src/
│   ├── components/     # 公共组件
│   ├── views/         # 页面组件
│   ├── router/        # 路由配置
│   ├── store/         # 状态管理
│   ├── api/           # API接口
│   ├── utils/         # 工具函数
│   └── assets/        # 静态资源

backend/           # 后端项目
├── src/
│   ├── modules/       # 业务模块
│   ├── common/        # 公共模块
│   ├── config/        # 配置文件
│   └── main.ts        # 入口文件
```

## 8. API接口规范

### 8.1 用户认证接口
```
POST /api/auth/register
POST /api/auth/login
POST /api/auth/logout
GET  /api/auth/profile
```

### 8.2 积分管理接口
```
GET  /api/points/balance          # 获取积分余额
POST /api/points/add              # 管理员增加积分
GET  /api/points/transactions     # 积分交易记录
```

### 8.3 钱包管理接口
```
GET  /api/wallet/balance          # 获取钱包余额
POST /api/wallet/recharge         # 模拟充值
POST /api/wallet/bind-card        # 绑定银行卡
GET  /api/wallet/transactions     # 钱包交易记录
```

### 8.4 积分市场接口
```
GET  /api/market/orders           # 获取市场订单列表
POST /api/market/sell             # 发布卖单
POST /api/market/buy              # 购买积分
GET  /api/market/my-orders        # 我的订单
```

### 8.5 公告管理接口
```
GET  /api/announcements           # 获取公告列表
GET  /api/announcements/:id       # 获取公告详情
POST /api/announcements           # 发布公告（管理员）
PUT  /api/announcements/:id       # 更新公告（管理员）
DELETE /api/announcements/:id     # 删除公告（管理员）
```

### 8.6 管理员接口
```
GET  /api/admin/users             # 获取用户列表
POST /api/admin/users/:id/points  # 给用户增加积分
GET  /api/admin/statistics        # 获取统计数据
```

## 9. 开发计划

### 9.1 第一阶段：基础功能（2周）
- 用户登录注册
- 首页积分展示
- 个人中心基础功能
- 钱包基础功能

### 9.2 第二阶段：交易功能（3周）
- 积分市场交易
- 订单管理系统
- 支付模拟功能

### 9.3 第三阶段：完善功能（2周）
- 公告系统
- 管理员功能
- 数据统计
- 性能优化

## 10. 技术实现建议

### 10.1 关键技术实现要点
1. **状态管理**：使用 Pinia 管理用户状态、积分余额、交易订单等全局状态
2. **路由守卫**：实现登录验证，保护需要认证的页面
3. **响应式设计**：使用 Vant UI 的栅格系统，确保各种设备兼容
4. **数据缓存**：合理使用 localStorage 缓存用户信息和常用数据
5. **错误处理**：统一的 API 错误处理机制，用户友好的错误提示

### 10.2 数据库设计建议
```sql
-- 用户表
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    phone VARCHAR(20),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 钱包表
CREATE TABLE wallets (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    balance DECIMAL(10,2) DEFAULT 0,
    frozen_balance DECIMAL(10,2) DEFAULT 0,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- 积分表
CREATE TABLE points (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    point_type ENUM('AIC', 'HH') NOT NULL,
    available_amount DECIMAL(10,4) DEFAULT 0,
    frozen_amount DECIMAL(10,4) DEFAULT 0,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- 积分交易订单表
CREATE TABLE market_orders (
    id INT PRIMARY KEY AUTO_INCREMENT,
    seller_id INT NOT NULL,
    point_type ENUM('AIC', 'HH') NOT NULL,
    total_amount DECIMAL(10,4) NOT NULL,
    remaining_amount DECIMAL(10,4) NOT NULL,
    unit_price DECIMAL(10,2) NOT NULL,
    status ENUM('active', 'completed', 'cancelled') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 10.3 安全性考虑
1. **密码加密**：使用 bcrypt 对用户密码进行加盐哈希
2. **JWT认证**：使用 JSON Web Token 进行用户身份验证
3. **输入验证**：前后端双重验证用户输入数据
4. **SQL注入防护**：使用 ORM 的参数化查询
5. **跨站攻击防护**：设置适当的 CORS 和 CSRF 防护

---

**注意**: 本文档为初版，需要根据您的具体回答不断完善和细化需求。
